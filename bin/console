#! /usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
Bundler.require(:tools)

require_relative '../lib/collectionspace_migration_tools'
require 'irb'

def reload!(print = true)
  load("#{Bundler.root}/lib/collectionspace_migration_tools.rb")
end

require "aws-sdk-s3"

def s3client
  CMT::Build::S3Client.call.value!
end

def upload_manual
  path = "/collectionobjects"
  id = "MH20220401_1"
  action = "UPDATE"
  delim = "|"
  #key = Base64.urlsafe_encode64([path, id, action].join(delim))
  key = 'L21lZGlhP2Jsb2JVcmk9aHR0cHM6Ly91cGxvYWQud2lraW1lZGlhLm9yZy93aWtpcGVkaWEvY29tbW9ucy90aHVtYi9lL2ViL051bWlkYV9tZWxlYWdyaXNfLU5nb3Jvbmdvcm8lMkNfVGFuemFuaWFfLXNpZGUtOC5qcGcvMTAyNHB4LU51bWlkYV9tZWxlYWdyaXNfLU5nb3Jvbmdvcm8lMkNfVGFuemFuaWFfLXNpZGUtOC5qcGd8TUgyMDIyMDQwMV8xfENSRUFURQ=='
  filepath = "#{CMT.config.client.xml_dir}/#{id}.xml"
  resp = s3client.put_object({
    body: File.read(filepath),
    bucket: CMT.config.client.s3_bucket,
    key: key
  })
end

def upload
end

def upload_produced(dir, key)
  filepath = "#{CMT.config.client.xml_dir}/#{dir}/#{key}"
  resp = s3client.put_object({
    body: File.read(filepath),
    bucket: CMT.config.client.s3_bucket,
    key: key
  })
end

IRB.conf[:BACK_TRACE_LIMIT]=10
IRB.conf[:INSPECT_MODE]=nil
IRB.start(__FILE__)

